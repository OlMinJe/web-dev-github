<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시계</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { padding: 30px 50px;}
        article { background-color: lightgoldenrodyellow; border: 1px solid gray; padding: 15px; margin: 20px 0; text-align: center; }
        .content { width: 80%; margin: 10px auto; padding: 20px; background-color: rgb(150, 125, 231); }
        input { font-size: 30px; }
        button { width: 150px; padding: 5px; font-size: 25px; background-color: #00c896; border: none; }
        button:hover { margin: auto; padding: 20px; background-color: #c0c0c0; }
        button#alarmAudio { display: none; }
        #pStopWatch { font-size: 50px; padding: 15px; background-color: white;}
        .watch { font-size: 50px; padding: 15px; background-color: white;}
        button:disabled {
            background-color: #c0c0c0;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <article>
        <h1>알람</h1>
        <div class="content">
            <input id="alarmDate" type="date">
            <input id="alarmTime" type="time">
            <button id="btnSetAlarm" onclick="setAlarm()">설정</button>
            <button id="audioStop" onclick="pause()">멈춤</button>
            <audio id="alarmAudio"> <!-- controls 숨김 -->
                <source src="" type="audio/mpeg">
            </audio>
        </div>
    </article>
    
    <article>
        <h1>스톱워치</h1>
        <div class="content">
            <p id="pStopWatch">00:00:00:0</p>
            <button id="btnSWReset" onclick="swReset()">리셋</button>
            <button id="btnSWStart" onclick="swStart()">시작</button>
            <button id="btnSWStop" onclick="swStop()">멈춤</button>
        </div>
    </article>

    <article>
        <h1>타이머</h1>
        <div class="content">
            <input id="tSetHours" type="number" min="0" max="24">
            <input id="tSetMinutes" type="number" min="0" max="59">
            <input id="tSetSeconds" type="number" min="0" max="59">
            <button id="btnTimerSet" onclick="timerSet()">설정</button>
            <p id="pTimerWatch" class="watch">00:02:00:0</p>
            <button id="btnTimerReset" onclick="timerReset()">리셋</button>
            <button id="btnTimerStart" onclick="timerStart()">시작</button>
            <button id="btnTimerStop" onclick="timerStop()">멈춤</button>
        </div>
    </article>

    <script>
        let alarmAudio = document.getElementById("alarmAudio");
        //let nowTime = new Date();
        //alarmDate.min = `${nowTime.getFullYear()}-${nowTime.getMonth() + 1}-${nowTime.getDate()}`;
        //alarmTime.min = `${nowTime.getHours()}:${nowTime.getMinutes()}`;
        let audioStop = document.getElementById("audioStop");
        let btnSetAlarm = document.getElementById("btnSetAlarm");
        let timerID = 0;
        let pStopWatch = document.getElementById("pStopWatch");
        let swTimer = null;

        function alarmPause() {
            alarmAudio.pause();
            audioStop.style.display = "none";
            btnSetAlarm.style.display = "inline-block";
        }

        function setAlarm() {
            clearTimeout(timerID);

            let alarmDate = document.getElementById("alarmDate");
            let alarmTime = document.getElementById("alarmTime");
        
            let dateString = `${alarmDate.value}T${alarmTime.value}`;
            let setAlarmTime = new Date(dateString);
            nowTime = new Date();

            let setTime = setAlarmTime - nowTime;
            if(setTime < 0) return;
            if(setTime <= 0) {
                alert("설정한 날씨 및 시간이 현재 시간 이전으로 되어 있습니다.");
                setAlarmTime.focus();
                return;
            }

            btnSetAlarm.style.display = "none";

            timerID = setTimeout(function() {
                btnSetAlarm.style.display = "none";
                audioStop.style.display = "inline-block";
                alarmAudio.play();
            }, setTime);

            console.log(alarmDate.value);
            console.log(alarmTime.value);
            console.log(setAlarmTime)
            console.log(nowTime);
            console.log(setTime);
        }

        // 스톱워치
        swReset();

        function showSWTime(d) {
            let h = (d.getHours() < 10) ? "0" + d.getHours() : d.getHours();
            let m = (d.getMinutes() < 10) ? "0" + d.getMinutes() : d.getMinutes();
            let s = (d.getSeconds() <10) ? "0" + d.getSeconds() : d.getSeconds();
            //let ms = d.getMillis

            //return `${h}:${m}:${s}:${ms}`;
            return `${h}:${m}:${s}`;
        }

        function swReset() {
            swTimer = new Date("1970-01-01T00:00:00");
            pStopWatch.innerHTML = showSWTime(swTimer);
        }

        function swStart() {
            clearInterval(timerID);
            timerID = setInterval(function() {
                swTimer.setTime(swTimer.getTime() + 100); // 0.1s 늘어남
                pStopWatch.innerHTML = showSWTime(swTimer);
                //console.log(swTimer);
            }, 100);

        }

        function swStop() {
            clearInterval(timerID)
        }

        //pStopWatch.innerHTML = `${swTimer.getHours()}:${swTimer.getMinutes()}:${swTimer.getSeconds()}`;
        //console.log(swTimer);


        // 타이머
        let tTimer = null;
        let tSetHours = document.getElementById("tSetHours");
        let tSetMinutes = document.getElementById("tSetMinutes");
        let tSetSeconds = document.getElementById("tSetSeconds");
        let pTimerWatch = document.getElementById("pTimerWatch");  
        let btnTimerSet = document.getElementById("btnTimerSet");
        let btnTimerReset = document.getElementById("btnTimerReset");
        let btnTimerStart = document.getElementById("btnTimerStart");
        let btnTimerStop = document.getElementById("btnTimerStop");

        timerReset();

        function setpTimerWatch(h, m, s) {
            tTimer.setHours(h);
            tTimer.setMinutes(m);
            tTimer.setSeconds(s);
            tTimer.setMilliseconds(0);

            pTimerWatch.innerHTML = showSWTime(tTimer);
        }

        function timerReset() {
            clearInterval(timerID);
            tTimer = new Date("1970-01-01");
            tSetHours.value = 0;
            tSetMinutes.value = 0;
            tSetSeconds.value = 0;

            setpTimerWatch(0, 0, 0);
        }

        function timerSet() {
            clearInterval(timerID);
            if(tSetHours.value == "0" && tSetMinutes.value == "0" && tSetSeconds.value == "0") {
                alert("측정할 시간을 설정해주세요.");
                tSetHours.focus();
                return;
            }

            setpTimerWatch(tSetHours.value, tSetMinutes.value, tSetSeconds.value);
            //tTimer = new Date(`1970-01-01T${timer.value}`);

            btnTimerStart.setAttribute("disabled", "disabled");
            btnTimerStop.setAttribute("disabled", "disabled");
        }

        function timerStart() {
            timerID = setInterval(function() {
                tTimer.setTime(tTimer.getTime() - 100);

                let timeDiff = tTimer.getTime() + (1000 * 60 * 60 * 9); // 9시간을 더함

                if(timeDiff <= 0) {
                    //console.log(timeDiff);
                    clearInterval(timerID);
                    timerReset();
                    alarmAudio.play();
                    return;
                }

                pTimerWatch.innerHTML = showSWTime(tTimer);
            }, 100);
        }

        function timerStop() {
            clearInterval(timerID);
            alarmAudio.pause();
        }
    </script>
</body>
</html>